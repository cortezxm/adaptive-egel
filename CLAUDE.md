# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

## Project Overview

**Adaptive-EGEL** is an intelligent tutoring system for the EGEL-COMPU exam. It transforms static study guides into an adaptive, personalized learning experience powered by Claude Code skills and LLMs.

**Key Principle:** Stateless skills that read/write JSON and Markdown files. Each skill invocation is independent; all state persists in the file system (no database, no external API calls beyond Claude).

---

## Architecture

### Three-Layer Design

1. **Knowledge Layer** (`knowledge_base/`)
   - All study guides and pedagogical content
   - `index_map.json`: Topic index with prerequisites, difficulty, estimated time
   - Lazy loading: Only load required topics per session

2. **User State Layer** (`user_profile/` + `progress/`)
   - `psyche.md`: Psychological profile (learning style, stress baseline, preferred feedback)
   - `progress.json`: Scores, study streak, dynamic roadmap, stress level
   - `sessions.log`: Timestamped session history

3. **Orchestration Layer** (Claude Code Skills)
   - 6 core skills: `/onboard`, `/study`, `/quiz`, `/status`, `/roadmap`, `/burnout-check`
   - Each skill is stateless and file-driven
   - No persistent memory between invocations

### File Structure

```
adaptive-egel/
├── .claude/skills/
│   ├── onboard/          # Skill: Initial psychological + knowledge assessment
│   ├── study/            # Skill: Daily study session with adaptive content
│   ├── quiz/             # Skill: Dynamic assessment + roadmap update
│   ├── status/           # Skill: Progress dashboard
│   └── roadmap/          # Skill: Explain topic prioritization
├── knowledge_base/
│   ├── index_map.json    # Topic metadata index
│   └── guias/            # Study guide .md files
├── user_profile/
│   └── psyche.md         # Generated by /onboard (psychological profile)
├── progress/
│   ├── progress.json     # User scores, streak, roadmap order
│   └── sessions.log      # Session history
├── first-prd.md          # Product requirements document
└── first-plan.md         # Detailed implementation plan
```

---

## Core Data Models

### `psyche.md` (User Psychological Profile)

Generated once by `/onboard`. Contains:

- Learning style preference (examples/theory/visual/kinesthetic)
- Pace (slow/medium/fast)
- Primary motivator (progress-tracking/gamification/intrinsic)
- Baseline stress level and error tolerance
- Personalized strategies for stress, frustration, and burnout

### `index_map.json` (Knowledge Index)

Structure:

```json
{
  "topics": [
    {
      "id": "sql-basics",
      "title": "SQL Basics",
      "file": "guias/sql-basics.md",
      "difficulty": "beginner",
      "prerequisites": [],
      "estimated_time_minutes": 45
    }
  ]
}
```

### `progress.json` (User Progress)

Contains:

- `user_name`, `assessment_date`, `current_date`
- `study_streak`: Days studied consecutively
- `stress_level`: low/medium/high (updated by `/quiz` and `/study`)
- `topics`: Dict with score, attempts, last_quiz_date, status, times_failed_consecutively
- `roadmap_order`: Array of topic IDs ordered by priority

### `sessions.log` (Session History)

Append-only log. Format: `YYYY-MM-DD | /skill | topic | details | metrics`

---

## The 6 Core Skills

### `/onboard`

**Purpose:** One-time initial setup. Ask 20-30 questions, generate `psyche.md` and initial `progress.json`.

**Key:** Only run once. Creates psychological baseline and initial roadmap.

### `/study`

**Purpose:** Daily study session with adaptive content and stress detection.

**Flow:**

1. Read `progress.json` + `psyche.md`
2. Optimize roadmap (prioritize topics with score < 70%, respect prerequisites)
3. Load main topic + prerequisites from `knowledge_base/` (lazy loading, max ~50-100k tokens)
4. Present material conversationally, adapted to `psyche.md`
5. Passively detect stress (language patterns); adapt pedagogy without asking
6. End with: "Let's validate with `/quiz` (5 questions, 10 min)"

**Token Budget:** ~20-30k per session, ~$0.05-0.10 cost

### `/quiz`

**Purpose:** Dynamic assessment + roadmap update.

**Flow:**

1. Generate 5 questions on the fly (difficulty adjusted to user level)
2. User answers conversationally
3. Evaluate each answer (nuanced, not binary)
4. Update `progress.json` (score, attempts, stress level, consecutive failures)
5. Adaptive response based on score and patterns

**Token Budget:** ~5-15k per quiz, ~$0.02-0.05 cost

### `/status`

**Purpose:** Progress dashboard showing streaks, mastered topics, weak areas, next recommendation.

**Tone:** Celebratory if progressing, supportive if struggling. Use `psyche.md` to calibrate.

### `/roadmap`

**Purpose:** Explain why topics are prioritized the way they are. Show prerequisites.

### `/burnout-check`

**Integration:** NOT a separate skill. Built into `/study` and `/quiz`.

**Detection Heuristics:**

- 3+ consecutive failures in same topic
- Frustration/self-doubt language patterns
- Stress level trending upward over 3+ sessions
- Streak broken after 5+ days

**Automatic Adaptation:** Switch pedagogy (theory → analogies/games), suggest breaks, celebrate small wins. Update `psyche.md` with new strategy.

---

## Implementation Guidelines

### For All Skills

1. **Read files at start:** Always read relevant JSON/MD before generating content
2. **Write atomically:** Read → modify in memory → write complete file (never partial updates)
3. **Timestamp everything:** Add `last_updated` and timestamps to tracked fields
4. **Conversational tone:** Adapt to user's `psyche.md`. No robotic outputs.
5. **Error handling:** If a file is missing, create sensible defaults (don't crash)

### Knowledge Loading

- Use `index_map.json` to find the right `.md` file
- Respect lazy loading: load topic + prerequisites only
- If a `.md` is huge, summarize or chunk it
- Max ~50-100k tokens of knowledge content per session

### Stress Detection & Adaptation

- Be proactive, not reactive. Adapt without asking permission.
- Log all burnout detection decisions in `progress.json` notes field
- Never shame user for struggling
- If 3+ consecutive failures detected, activate alternative pedagogies (analogies, games, real-world examples)

### Roadmap Logic

```
For each topic:
  if score < 70%:
    priority = 1 (highest)
  elif times_failed_consecutively >= 3:
    priority = 2 (activate deep analysis)
  elif score < 85%:
    priority = 3 (needs review)
  else:
    priority = 4 (mastered)

Sort by priority → roadmap_order

Respect prerequisites: Don't suggest topic X if prerequisite Y has score < 60%
```

---

## Conventions & Style

- **All skills:** English language
- **All files:** English (JSON, Markdown)
- **Filenames:** snake_case (`index_map.json`, `psyche.md`)
- **Skill names:** kebab-case (`/onboard`, `/study`, `/quiz`, etc.)
- **JSON:** Pretty-printed, 2-space indentation
- **Markdown:** Clear heading hierarchy, no unnecessary formatting
- **Error messages:** Supportive tone, actionable guidance
- **Code in skills:** Use Read/Edit/Write tools (not Bash) for file operations where possible

---

## Key Design Decisions

**Why Stateless Skills + File-Based State:**

- Independent skill invocations (no persistent memory)
- All state in human-readable JSON/MD (version-controllable)
- Lazy loading enables token efficiency
- Easier to debug and understand system state

**Why No Database:**

- Simpler deployment and maintenance
- User can inspect/modify files directly
- File-based allows easy integration with version control
- Aligns with Claude Code's file-first philosophy

**Why Hybrid Roadmap Optimizer:**

- Simple logic (score < 70% → prioritize) handles most cases
- Deep analysis only when anomalies detected (3+ failures)
- Balances intelligence with token efficiency

---

## Development Workflow

1. **Setup:** Review `first-plan.md` and `first-prd.md` for full context
2. **Implement skills in order:** `/onboard` → `/study` → `/quiz` → `/status` → `/roadmap`
3. **Before implementing:** Ensure directories exist under `.claude/skills/`
4. **For each skill:** Create `SKILL.md` with skill definition and implementation notes
5. **Test:** Run full flow: `/onboard` → `/study` → `/quiz` → `/status`
6. **Monitor:** Check token usage and user engagement metrics

---

## Key References

- `first-prd.md`: Product Requirements Document with vision, objectives, and use cases
- `first-plan.md`: Detailed implementation plan with technical specifications
- Original inspiration: https://github.com/juanQNav/Egel-computer-science

---
